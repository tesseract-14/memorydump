package net.fabricmc.memorydmp.entity;

import net.fabricmc.memorydmp.MemoryDmpMod;
import net.minecraft.entity.EntityType;
import net.minecraft.entity.LivingEntity;
import net.minecraft.entity.projectile.thrown.ThrownItemEntity;
import net.minecraft.item.Item;
import net.minecraft.item.Items;
import net.minecraft.sound.SoundCategory;
import net.minecraft.sound.SoundEvents;
import net.minecraft.util.hit.HitResult;
import net.minecraft.world.World;
import net.minecraft.entity.LightningEntity;
import net.minecraft.world.explosion.Explosion;


public class TeleportOrbEntity extends ThrownItemEntity {
    public TeleportOrbEntity(EntityType<? extends TeleportOrbEntity> type, World world) {
        super(type, world);
    }

    public TeleportOrbEntity(World world, LivingEntity owner) {
        super(MemoryDmpMod.TELEPORT_ORB, owner, world);
    }

    @Override
    protected Item getDefaultItem() {
        return Items.ENDER_PEARL; // purely visual placeholder, doesnâ€™t matter
    }

    @Override
    protected void onCollision(HitResult hit) {
        super.onCollision(hit);

        if (!this.getWorld().isClient) {
            if (Math.random() < 0.2){
                if (Math.random() < 0.5){
                    LightningEntity lightning = EntityType.LIGHTNING_BOLT.create(world);
                    if (lightning != null) {
                        lightning.refreshPositionAfterTeleport(getX(), getY(), getZ());
                        world.spawnEntity(lightning);
                    }
                }else{
                    world.createExplosion(getOwner(), getX(), getY(), getZ(), 1.5F, Explosion.DestructionType.NONE);
                }
            }


            if (this.getOwner() instanceof LivingEntity owner) {
                owner.requestTeleport(this.getX(), this.getY(), this.getZ());
                this.getWorld().playSound(null, getX(), getY(), getZ(),
                        SoundEvents.ENTITY_ENDERMAN_TELEPORT, SoundCategory.PLAYERS,
                        1.0F, 1.0F);
            }

            // Remove the orb
            this.discard();
        }
    }
}
